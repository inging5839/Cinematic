{% load static %}
<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cinematic Emotion Lab</title>

  <link rel="stylesheet" href="{% static 'app/css/style.css' %}?v=3">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.150.1/three.min.js"></script>
  <script src="{% static 'app/js/script.js' %}?v=14"></script>

</head>

<body>
  <div class="bg-aurora" aria-hidden="true"></div>
  <div class="bg-stars" aria-hidden="true"></div>

  <main class="page">
    <!-- HERO -->
    <section class="hero" id="top">
      <div class="hero__inner">
        <div class="hero__kicker">MOVIE COLOR ARCHIVE</div>
        <h1 class="hero__title">Cinematic Image<br/>Emotional Visualization</h1>
      </div>
    </section>

    <!-- POSTER -->
    <section class="section" id="poster">
      <header class="section__head">
        <h2 class="section__title">Poster Color Calibration</h2>
      </header>

      <div class="grid2">
        <div class="card">
          <div class="card__title">포스터 업로드</div>
          <div class="uploader">
            <input class="uploader__input" type="file" id="posterInput" accept="image/*" />
            <label class="uploader__label" for="posterInput">
              <span class="uploader__labelText">포스터 이미지 선택</span>
              <span class="uploader__fileName" id="posterFileName">선택된 파일 없음</span>
            </label>

            <div class="status" id="posterStatus">상태: 대기</div>

            <button class="btn btn--primary posterAction" id="analyzePosterBtn">
                포스터 색 분석 & 행성 반영
            </button>
          </div>
        </div>

        <div class="card">
          <div class="card__title">분석 결과</div>
          <div class="posterPreview">
            <div class="posterPreview__frame" id="posterPreviewFrame">
              <div class="posterPreview__placeholder">Poster preview</div>
              <img id="posterPreviewImg" alt="poster preview" />
            </div>

            <div class="palette">
              <div class="palette__title">대표 Hue 팔레트</div>
              <div class="palette__spectrum">
                <canvas id="paletteSpectrumCanvas" width="800" height="80"></canvas>
              </div>
              <div class="palette__row" id="posterPaletteRow">
                <!-- swatches injected -->
              </div>
              <div class="palette__note">
                * 팔레트는 포스터 픽셀에서 Hue 히스토그램을 계산해 상위 색을 추출합니다.
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- PLANETS -->
    <section class="section" id="planets">
      <header class="section__head">
        <h2 class="section__title">Emotion Planets</h2>
        <p class="section__subtitle">
          긍부정도(1~9)에 따라 9개 행성이 존재하며, 각 행성은 자기 궤도(완전한 원)에서 지속적으로 움직입니다.
          포스터의 컬러 스펙트럼이 행성 색에 반영됩니다.
        </p>
      </header>

      <div class="card card--wide">
        <div class="planetStage">
          <div class="orbitWrap" id="orbitWrap" aria-label="planet orbits">
            <!-- Three.js 3D Canvas -->
            <canvas id="planetCanvas" style="width: 100%; height: 100%;"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- SCENE UPLOAD -->
    <section class="section" id="scene">
      <header class="section__head">
        <h2 class="section__title">Scene Upload & Positivity Label</h2>
        <p class="section__subtitle">
          영화 장면 이미지를 업로드하고 긍부정도(1~9)를 부여해 데이터셋 수집에 기여합니다.
          업로드된 장면은 즉시 누적(S/V) 데이터에 반영되며 갤러리에 추가됩니다.
        </p>
      </header>

      <div class="card">
        <div class="card">
            <form class="sceneForm" id="sceneForm">
          
              <div class="sceneLayout">
          
                <!-- LEFT : PREVIEW (고정) -->
                <div class="sceneLayout__preview">
                  <div class="scenePreview__frame" id="scenePreviewFrame">
                    <div class="scenePreview__placeholder">Scene preview</div>
                    <img id="scenePreviewImg" alt="scene preview" />
                  </div>
                  <div class="scenePreview__badge" id="sceneSelectedBadge">선택됨</div>
                </div>
          
                <!-- RIGHT : CONTROLS (세로 정렬) -->
                <div class="sceneLayout__controls">
          
                  <!-- 1. Scene image (Multiple files supported) -->
                  <div class="field">
                    <label class="field__label" for="sceneInput">Scene image (다중 선택 가능)</label>
                    <input class="field__file" type="file" id="sceneInput" accept="image/*" multiple />
                    <div class="fileMeta">
                      <span class="fileMeta__label">선택됨:</span>
                      <span class="fileMeta__name" id="sceneFileName">없음</span>
                    </div>
                  </div>
          
                  <!-- 2. Movie title -->
                  <div class="field">
                    <label class="field__label" for="movieTitle">영화 제목</label>
                    <input class="field__input" id="movieTitle" type="text" placeholder="예: Titanic" />
                  </div>
          
                  <!-- 3. Positivity -->
                  <div class="field">
                    <label class="field__label" for="positivitySelect">긍부정도 (1~9)</label>
                    <select class="field__select" id="positivitySelect">
                      <option value="" disabled selected>선택</option>
                      <option>1</option><option>2</option><option>3</option>
                      <option>4</option><option>5</option><option>6</option>
                      <option>7</option><option>8</option><option>9</option>
                    </select>
                  </div>
          
                  <!-- 4. Status -->
                  <div class="status status--block" id="sceneStatus">
                    상태: 대기
                  </div>
          
                  <!-- 5. Buttons -->
                  <div class="sceneActions">
                    <button class="btn btn--primary" type="submit">장면 업로드</button>
                    <button class="btn btn--danger" type="button" id="resetAllBtn">전체 초기화</button>
                  </div>
          
                </div>
              </div>
            </form>
          </div>
    </section>

    <!-- DATA VIS -->
    <section class="section" id="data">
      <header class="section__head">
        <h2 class="section__title">Positivity-Level Color Distribution Visualization</h2>
        <p class="section__subtitle">
          업로드된 장면 이미지에서 추출한 HSV의 S/V(채도/명도)를 레벨별로 누적합니다.
          표(정형화 데이터) + 그래프(요약 시각화)를 동시에 제공합니다.
        </p>
      </header>

      <div class="dataGrid">
        <div class="card">
          <div class="card__title">SV 누적 현황 (Positivity 1~9)</div>
          <div class="tableWrap">
            <table class="dataTable" id="svTable">
              <thead>
                <tr>
                  <th>Level</th>
                  <th>Count</th>
                  <th>S Min</th>
                  <th>S Avg</th>
                  <th>S Max</th>
                  <th>V Min</th>
                  <th>V Avg</th>
                  <th>V Max</th>
                </tr>
              </thead>
              <tbody id="svTableBody">
                <!-- rows injected -->
              </tbody>
            </table>
          </div>
          <div class="tableFoot">
            <span class="dot" id="filterDot"></span>
            <span id="filterText">필터: 전체(ALL)</span>
          </div>
        </div>

        <div class="card">
          <div class="card__title">Count (업로드 개수)</div>
          <div class="chartWrap">
            <canvas id="countChart" width="900" height="240" aria-label="count chart"></canvas>
          </div>

          <div class="card__title card__title--mt">Average S / V</div>
          <div class="chartWrap">
            <canvas id="svChart" width="900" height="900" aria-label="sv chart"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- GALLERY -->
    <section class="section" id="gallery">
      <header class="section__head">
        <h2 class="section__title">Scene Gallery</h2>
        <p class="section__subtitle">
          Shows collected movie scenes individually in gallery format. Level filters/search/alignments are possible.
        </p>
      </header>

      <div class="card card--wide">
        <div class="galleryToolbar">
          <div class="galleryToolbar__left">
            <input class="search" id="gallerySearch" type="text" placeholder="영화 제목으로 검색 (예: Titanic)" />
          </div>

          <div class="galleryToolbar__right">
            <select class="selectSmall" id="gallerySort">
              <option value="newest" selected>최신순</option>
              <option value="oldest">오래된순</option>
              <option value="levelHigh">긍부정도 높은순</option>
              <option value="levelLow">긍부정도 낮은순</option>
            </select>

            <!-- End of Selection -->
          </div>
        </div>

        <div class="galleryGrid" id="galleryGrid">
          <!-- cards injected -->
        </div>

        <div class="empty" id="galleryEmpty">
          아직 업로드된 장면이 없습니다. Scene 섹션에서 장면을 업로드해 주세요.
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="footer__inner">
        <div>© Cinematic Emotion Lab — FE Prototype</div>
        <button class="btn btn--ghost" id="backToTopBtn" type="button">Back to top</button>
      </div>
    </footer>
  </main>

  <!-- hidden canvas used for analysis -->
  <canvas id="workCanvas" width="16" height="16" class="hidden"></canvas>
</body>
</html>
