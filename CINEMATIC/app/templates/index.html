{% load static %}
<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CIEV</title>
  
  <link rel="stylesheet" href="{% static 'app/css/style.css' %}?v=5">
  
  <!-- Favicon - Using existing image as fallback until multi-size versions are created -->
  <link rel="icon" type="image/png" href="{% static 'app/images/favicon_001.png' %}">
  <link rel="apple-touch-icon" href="{% static 'app/images/favicon_001.png' %}">
  
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.150.1/three.min.js"></script>
  <script src="{% static 'app/js/script.js' %}?v=22"></script>

</head>

<body>
  <div class="bg-aurora" aria-hidden="true"></div>
  <div class="bg-stars" aria-hidden="true"></div>

  <main class="page">
    <!-- HERO -->
    <section class="hero" id="top">
      <div class="hero__inner">
        <div class="hero__kicker">MOVIE COLOR ARCHIVE</div>
        <div class="hero__title-container">
          <img src="{% static 'app/images/favicon_001.png' %}" alt="CIEV" class="hero__logo">
          <h1 class="hero__title">CIEV</h1>
        </div>
        <div class="hero__desc">Cinematic Image Emotional Visualization</div>
      </div>
    </section>

    <!-- POSTER -->
    <section class="section" id="poster">
      <header class="section__head">
        <h2 class="section__title">Poster Color Calibration</h2>
      </header>

      <div class="grid2">
        <div class="card">
          <div class="card__title">Upload Poster</div>
          <div class="uploader">
            <input class="uploader__input" type="file" id="posterInput" accept="image/*" />
            <label class="uploader__label" for="posterInput">
              <span class="uploader__labelText">Select Poster Image</span>
              <span class="uploader__fileName" id="posterFileName">No file selected</span>
            </label>

            <div class="status" id="posterStatus">Status: Waiting</div>

            <button class="btn btn--primary posterAction" id="analyzePosterBtn">
                Analyze Poster Colors & Apply to Planets
            </button>
          </div>
        </div>

        <div class="card">
          <div class="card__title">Analysis Result</div>
          <div class="posterPreview">
            <div class="posterPreview__frame" id="posterPreviewFrame">
              <div class="posterPreview__placeholder">Poster preview</div>
              <img id="posterPreviewImg" alt="poster preview" />
            </div>

            <div class="palette">
              <div class="palette__title">Dominant Hue Palette</div>
              <div class="palette__spectrum">
                <canvas id="paletteSpectrumCanvas" width="800" height="80"></canvas>
              </div>
              <div class="palette__row" id="posterPaletteRow">
                <!-- swatches injected -->
              </div>
              <div class="palette__note">
                * The palette is extracted from the Hue histogram of the poster pixels.
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- PLANETS -->
    <section class="section" id="planets">
      <header class="section__head">
        <h2 class="section__title">Emotion Planets</h2>
      </header>

      <div class="card card--wide">
        <div class="planetStage">
          <div class="orbitWrap" id="orbitWrap" aria-label="planet orbits">
            <!-- Three.js 3D Canvas -->
            <canvas id="planetCanvas" style="width: 100%; height: 100%;"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- SCENE UPLOAD -->
    <section class="section" id="scene">
      <header class="section__head">
        <h2 class="section__title">Scene Upload & Positivity Label</h2>
      </header>

      <div class="card">
        <div class="card">
            <form class="sceneForm" id="sceneForm">
          
              <div class="sceneLayout">
          
                <!-- LEFT : PREVIEW (Í≥†Ï†ï) -->
                <div class="sceneLayout__preview">
                  <div class="scenePreview__frame" id="scenePreviewFrame">
                    <div class="scenePreview__placeholder">Scene preview</div>
                    <img id="scenePreviewImg" alt="scene preview" />
                  </div>
                  <div class="scenePreview__badge" id="sceneSelectedBadge">ÏÑ†ÌÉùÎê®</div>
                </div>
          
                <!-- RIGHT : CONTROLS (ÏÑ∏Î°ú Ï†ïÎ†¨) -->
                <div class="sceneLayout__controls">
          
                  <!-- 1. Scene image (Multiple files supported) -->
                  <div class="field">
                    <label class="field__label" for="sceneInput">Scene image</label>
                    <input class="field__file" type="file" id="sceneInput" accept="image/*" multiple />
                    <div class="fileMeta">
                      <span class="fileMeta__label">Selected:</span>
                      <span class="fileMeta__name" id="sceneFileName">No file selected</span>
                    </div>
                  </div>
          
                  <!-- 2. Movie title -->
                  <div class="field">
                    <label class="field__label" for="movieTitle">Movie Title</label>
                    <input class="field__input" id="movieTitle" type="text" placeholder="Example: Titanic" />
                  </div>
          
                  <!-- 3. Positivity -->
                  <div class="field">
                    <label class="field__label" for="positivitySelect">Positivity (1~9)</label>
                    <select class="field__select" id="positivitySelect">
                      <option value="" disabled selected>Select</option>
                      <option>1</option><option>2</option><option>3</option>
                      <option>4</option><option>5</option><option>6</option>
                      <option>7</option><option>8</option><option>9</option>
                    </select>
                  </div>
          
                  <!-- 4. Status -->
                  <div class="status status--block" id="sceneStatus">
                    Status: Waiting
                  </div>
          
                  <!-- 5. Buttons -->
                  <div class="sceneActions">
                    <button class="btn btn--primary" type="submit">Upload Scene</button>
                    <button class="btn btn--danger" type="button" id="resetAllBtn">Reset All</button>
                  </div>
          
                </div>
              </div>
            </form>
          </div>
    </section>

    <!-- STATISTICAL ANALYSIS -->
    <section class="section" id="statistics">
      <header class="section__head">
        <h2 class="section__title">Statistical Analysis</h2>
      </header>

      <div class="grid2">
        <!-- Summary Widget -->
        <div class="card">
          <div class="card__title">Total Statistics Summary</div>
          <div class="statsWidget" id="statsWidget">
            <div class="statsWidget__item">
              <div class="statsWidget__label">Total Scenes</div>
              <div class="statsWidget__value" id="statTotalScenes">-</div>
            </div>
            <div class="statsWidget__item">
              <div class="statsWidget__label">Average Positivity</div>
              <div class="statsWidget__value" id="statAvgLevel">-</div>
            </div>
            <div class="statsWidget__item">
              <div class="statsWidget__label">Average Saturation (S)</div>
              <div class="statsWidget__value" id="statAvgS">-</div>
            </div>
            <div class="statsWidget__item">
              <div class="statsWidget__label">Average Value (V)</div>
              <div class="statsWidget__value" id="statAvgV">-</div>
            </div>
          </div>

          <div class="card__title card__title--mt">Export Data</div>
          <div class="exportButtons">
            <button class="btn btn--secondary" id="exportScenesCSV">
              <span>üìä</span> Download Scene Data CSV
            </button>
            <button class="btn btn--secondary" id="exportAggregatesCSV">
              <span>üìà</span> Download Statistics Data CSV
            </button>
            <button class="btn btn--secondary" id="exportJSON">
              <span>üíæ</span> Download All JSON
            </button>
          </div>
        </div>

        <!-- Correlation Analysis -->
        <div class="card">
          <div class="card__title">Correlation Analysis</div>
          <div class="correlationSection" id="correlationSection">
            <button class="btn btn--primary" id="analyzeCorrelationBtn">
              Run Correlation Analysis
            </button>
            <div class="correlationResults" id="correlationResults" style="display: none;">
              <div class="correlationItem">
                <div class="correlationItem__title">Hue</div>
                <div class="correlationItem__stats" id="corrHue"></div>
              </div>
              <div class="correlationItem">
                <div class="correlationItem__title">Saturation</div>
                <div class="correlationItem__stats" id="corrSaturation"></div>
              </div>
              <div class="correlationItem">
                <div class="correlationItem__title">Value</div>
                <div class="correlationItem__stats" id="corrValue"></div>
              </div>
              <div class="correlationInterpretation" id="corrInterpretation"></div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- DATA VIS -->
    <section class="section" id="data">
      <header class="section__head">
        <h2 class="section__title">Positivity-Level Color Distribution Visualization</h2>
      </header>

      <div class="dataGrid">
        <div class="card">
          <div class="card__title">SV Accumulation Status (Positivity 1~9)</div>
          <div class="tableWrap">
            <table class="dataTable" id="svTable">
              <thead>
                <tr>
                  <th>Level</th>
                  <th>Count</th>
                  <th>S Min</th>
                  <th>S Avg</th>
                  <th>S Max</th>
                  <th>V Min</th>
                  <th>V Avg</th>
                  <th>V Max</th>
                </tr>
              </thead>
              <tbody id="svTableBody">
                <!-- rows injected -->
              </tbody>
            </table>
          </div>
          <div class="tableFoot">
            <span class="dot" id="filterDot"></span>
            <span id="filterText">Filter: All (ALL)</span>
          </div>
        </div>

        <div class="card">
          <div class="card__title">Count (Upload Count)</div>
          <div class="chartWrap">
            <canvas id="countChart" width="900" height="240" aria-label="count chart"></canvas>
          </div>

          <div class="card__title card__title--mt">Average S / V</div>
          <div class="chartWrap">
            <canvas id="svChart" width="900" height="900" aria-label="sv chart"></canvas>
          </div>
        </div>
      </div>
    </section>

    <!-- GALLERY -->
    <section class="section" id="gallery">
      <header class="section__head">
        <h2 class="section__title">Scene Gallery</h2>
      </header>

      <div class="card card--wide">
        <div class="galleryToolbar">
          <div class="galleryToolbar__left">
            <input class="search" id="gallerySearch" type="text" placeholder="Search by Movie Title (Example: Titanic)" />
          </div>

          <div class="galleryToolbar__right">
            <select class="selectSmall" id="gallerySort">
              <option value="newest" selected>Newest</option>
              <option value="oldest">Oldest</option>
              <option value="levelHigh">Highest Positivity</option>
              <option value="levelLow">Lowest Positivity</option>
            </select>

            <!-- End of Selection -->
          </div>
        </div>

        <div class="galleryGrid" id="galleryGrid">
          <!-- cards injected -->
        </div>

        <div class="empty" id="galleryEmpty">
          No scenes uploaded yet. Please upload scenes in the Scene section.
        </div>

        <div class="galleryLoading" id="galleryLoading" style="display: none; text-align: center; padding: 2rem; color: var(--text-muted);">
          <div class="spinner" style="display: inline-block; width: 20px; height: 20px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite;"></div>
          <div style="margin-top: 0.5rem;">Loading more images...</div>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div class="footer__inner">
        <div>¬© CIEV</div>
        <button class="btn btn--ghost" id="backToTopBtn" type="button">Back to top</button>
      </div>
    </footer>
  </main>

  <!-- hidden canvas used for analysis -->
  <canvas id="workCanvas" width="16" height="16" class="hidden"></canvas>
</body>
</html>
